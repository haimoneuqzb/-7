<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>آلة حاسبة علمية — مهيمن</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.8.0/dist/math.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #1e3a8a, #9333ea);
      color: #fff;
      font-family: "Tajawal", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
      transition: background 2s linear;
      animation: bgChange 20s infinite alternate;
    }

    @keyframes bgChange {
      0% {background: linear-gradient(135deg, #1e3a8a, #9333ea);}
      25% {background: linear-gradient(135deg, #ea580c, #facc15);}
      50% {background: linear-gradient(135deg, #059669, #10b981);}
      75% {background: linear-gradient(135deg, #8b5cf6, #ec4899);}
      100% {background: linear-gradient(135deg, #1e3a8a, #9333ea);}
    }

    h1 {
      margin-bottom: 14px;
      color: #fcd34d;
      text-shadow: 0 0 15px #fcd34d;
      font-size: 1.7rem;
    }

    .calculator {
      background: rgba(17,24,39,0.95);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 0 40px rgba(252, 211, 77,0.5);
      width: 360px;
      max-width: 100%;
      transition: box-shadow 0.3s, background 0.3s;
    }

    #display {
      width: 100%;
      height: 60px;
      font-size: 1.4rem;
      text-align: right;
      border: none;
      outline: none;
      border-radius: 12px;
      margin-bottom: 12px;
      padding: 10px 14px;
      background: #fefefe;
      color: #111827;
      font-weight: bold;
      transition: background 0.3s, color 0.3s;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
    }

    button {
      padding: 14px 8px;
      font-size: 1rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      background: #374151;
      color: #fefefe;
      transition: transform 0.1s, background 0.2s, box-shadow 0.3s;
      user-select: none;
    }

    button:hover {
      transform: translateY(-3px);
      background: #f59e0b;
      color: #111827;
      box-shadow: 0 0 10px rgba(245,158,11,0.7);
    }

    .op { background: #4b5563; }
    .equals {
      background: linear-gradient(90deg,#f59e0b,#d97706);
      color: #111827;
      grid-column: span 2;
      transition: transform 0.1s, box-shadow 0.2s;
    }
    .equals:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 20px rgba(245,158,11,0.6);
    }

    .clear { background: #ef4444; color: #fff; }
    .mode { background: #3b82f6; color: #fff; }
    .small { font-size: 0.9rem; padding: 10px 6px; }
    footer { margin-top: 12px; font-size: 0.8rem; color: #e5e7eb; text-align: center; }
  </style>
</head>
<body>
  <h1>آلة حاسبة علمية — مهيمن</h1>
  <div class="calculator" role="application" aria-label="آلة حاسبة علمية">
    <input id="display" type="text" readonly aria-label="شاشة الآلة الحاسبة">
    <div class="buttons">
      <button class="small mode" id="degToggle">RAD</button>
      <button class="small op" onclick="insertFunc('sin')">sin</button>
      <button class="small op" onclick="insertFunc('cos')">cos</button>
      <button class="small op" onclick="insertFunc('tan')">tan</button>
      <button class="small op" onclick="insertFunc('log10')">log</button>
      <button class="small op" onclick="insertFunc('log')">ln</button>

      <button onclick="append('(')">(</button>
      <button onclick="append(')')">)</button>
      <button onclick="append('π')">π</button>
      <button onclick="append('e')">e</button>
      <button class="op" onclick="insertFunc('sqrt')">√</button>
      <button class="op" onclick="append('!')">n!</button>

      <button onclick="append('7')">7</button>
      <button onclick="append('8')">8</button>
      <button onclick="append('9')">9</button>
      <button class="op" onclick="append('÷')">÷</button>
      <button class="op" onclick="append('^')">^</button>
      <button class="op" onclick="insertFunc('abs')">abs</button>

      <button onclick="append('4')">4</button>
      <button onclick="append('5')">5</button>
      <button onclick="append('6')">6</button>
      <button class="op" onclick="append('×')">×</button>
      <button class="op" onclick="insertFunc('pow')">pow</button>
      <button class="op" onclick="append('%')">%</button>

      <button onclick="append('1')">1</button>
      <button onclick="append('2')">2</button>
      <button onclick="append('3')">3</button>
      <button class="op" onclick="append('−')">−</button>
      <button onclick="insertFunc('exp')">exp</button>
      <button onclick="insertFunc('sqrt')">root</button>

      <button onclick="append('0')">0</button>
      <button onclick="append('.')">.</button>
      <button class="equals" onclick="calculate()">=</button>
      <button onclick="append('+')">+</button>
      <button class="clear" onclick="clearDisplay()">C</button>
      <button onclick="backspace()">⌫</button>
    </div>
  </div>
  <footer>اضغط Enter للحساب — ESC للمسح — Backspace للحذف</footer>

  <script>
    const display = document.getElementById('display');
    const degToggle = document.getElementById('degToggle');
    let isDegrees = false;
    const math = window.math;

    degToggle.addEventListener('click', () => { 
      isDegrees = !isDegrees; 
      degToggle.textContent = isDegrees ? 'DEG' : 'RAD';
    });

    function append(value) { display.value += value; }
    function insertFunc(name) { display.value += name + '('; }
    function clearDisplay() { display.value = ''; }
    function backspace() { display.value = display.value.slice(0,-1); }

    function preprocessExpression(expr){
      return expr.replace(/×/g,'*').replace(/÷/g,'/').replace(/−/g,'-')
                 .replace(/π/g,'pi').replace(/%/g,'/100')
                 .replace(/(\d+)!/g,'factorial($1)');
    }

    function degreeTrigScope(math){
      return {
        sin: x=> math.sin(isDegrees? math.unit(x,'deg'): x),
        cos: x=> math.cos(isDegrees? math.unit(x,'deg'): x),
        tan: x
